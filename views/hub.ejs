<%- include('../partials/navbar') %>
<title>MeowStresser - Hub</title>
<link rel="stylesheet" href="/css/hub.css">
<div class="container mx-auto p-4 text-[#ccd2e3]" id="content" style="max-width: 80rem">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
        <div class="bg-card-bg p-4 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl fade-in">
            <h2 class="text-[#ccd2e3] mb-2">Total Users</h2>
            <div class="flex items-center text-[#A6B0CF]">
                <span class="text-2xl font-bold mr-2" id="totalUsers">0</span> 
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M9 11C11.2091 11 13 9.20914 13 7C13 4.79086 11.2091 3 9 3C6.79086 3 5 4.79086 5 7C5 9.20914 6.79086 11 9 11Z" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" />
                    <path d="M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" />
                    <path d="M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" />
                </svg>
            </div>
        </div>
        <div class="bg-card-bg p-4 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl fade-in">
            <h2 class="text-[#ccd2e3] mb-2">Total Attacks</h2>
            <div class="flex items-center text-[#A6B0CF]">
                <span class="text-2xl font-bold mr-2" id="totalAttacks">0</span> 
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M12 6V12L16 14" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>
        <div class="bg-card-bg p-4 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl fade-in">
            <h2 class="text-[#ccd2e3] mb-2">Running Boots</h2>
            <div class="flex items-center text-[#A6B0CF]">
                <span class="text-2xl font-bold mr-2" id="runningBoots">0</span> 
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M13 2L3 14H12L11 22L21 10H12L13 2Z" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </div>
        </div>
        <div class="bg-card-bg p-4 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl fade-in">
            <h2 class="text-[#ccd2e3] mb-2">Users Online</h2>
            <div class="flex items-center text-[#A6B0CF]">
                <span class="text-2xl font-bold mr-2" id="usersOnline">0</span> 
                <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M12 11C14.2091 11 16 9.20914 16 7C16 4.79086 14.2091 3 12 3C9.79086 3 8 4.79086 8 7C8 9.20914 9.79086 11 12 11Z" stroke="#A6B0CF" stroke-width="2" stroke-linecap="round" />
                </svg>
            </div>
        </div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-2 bg-card-bg p-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl fade-in">
            <h2 class="text-xl font-bold mb-4 flex items-center">
                <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19 3H5C3.89543 3 3 3.89543 3 5V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V5C21 3.89543 20.1046 3 19 3Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M10 7H7V16H10V7Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M17 7H14V12H17V7Z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
                News
            </h2>
            <div class="space-y-4 overflow-y-auto" style="max-height: 250px;">
                <div>
                    <h3 class="text-green flex items-center mb-2">
                        <span class="w-2 h-2 bg-green rounded-full mr-2"></span>
                        Updates
                    </h3>
                    <p class="text-[#A6B0CF] text-sm">
                        • Layer 4 Network: Our new network is now up and running, with 180 slots available for Layer 4 attacks.
                    </p>
                    <p class="text-[#A6B0CF] text-sm mt-2">
                        • Backend Updates: Fixed issue that was making users be able to send more concurrents than they have, accounts abusing this have been suspended.
                    </p>
                    <p class="text-[#A6B0CF] text-sm mt-2">
                        • Soon: Layer 7 method HTTP-BETA will be updated to bypass latest Cloudflare rules.
                    </p>
                    <p class="text-[#A6B0CF] text-xs mt-2">August 24, 2024</p>
                </div>
                <div>
                    <h3 class="text-green flex items-center mb-2">
                        <span class="w-2 h-2 bg-green rounded-full mr-2"></span>
                        Layer 4 Updates
                    </h3>
                    <p class="text-[#A6B0CF] text-sm">
                        • TCP-WLA: This new method replaces the old TCP-SYN methods. It sends TCP options from known operating systems like Windows, Android, iPhone, and Linux, providing better performance bypassing protected targets.
                    </p>
                    <p class="text-[#A6B0CF] text-xs mt-2">July 30, 2024</p>
                </div>
            </div>
        </div>
        <div class="bg-card-bg p-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl fade-in">
            <div class="flex flex-col items-center">
                <img src="/default-avatar.png" alt="User Avatar" class="w-24 h-24 rounded-full mb-4 transition-transform duration-300 hover:scale-110" />
                <h2 class="text-xl font-bold mb-2"><%= user.username %></h2>
                <span class="bg-[#4458b8] text-xs px-2 py-1 rounded-full mb-4"><%= user.planName %></span>
                <div class="grid grid-cols-3 gap-4 w-full text-center">
                    <div>
                        <p class="text-[#ccd2e3] text-sm">Concurrents</p>
                        <p class="font-bold text-[#A6B0CF]"><%= user.concurrents %></p>
                    </div>
                    <div>
                        <p class="text-[#ccd2e3] text-sm">Max Boot</p>
                        <p class="font-bold text-[#A6B0CF]"><%= user.maxAttackTime %></p>
                    </div>
                    <div>
                        <p class="text-[#ccd2e3] text-sm">Expire</p>
                        <p class="font-bold text-[#A6B0CF]"><%= user.activationDate ? user.activationDate.toDateString() : 'n/a' %></p>
                    </div>
                </div>
                <button id="logoutButton" 
                    class="mt-4 bg-[#4458b8] text-white px-4 py-2 rounded-md transition-all duration-300 hover:bg-[#2a3773] pulse shimmer" 
                    onclick="fetch('/logout', { method: 'POST', credentials: 'include' }).then(response => { if (response.ok) { window.location.href = '/'; } });">
                    Logout
                </button>
            </div>
        </div>
    </div>
    <div class="mt-6 bg-card-bg p-6 rounded-lg shadow-lg transition-all duration-300 hover:shadow-xl fade-in">
        <h2 class="text-xl font-bold mb-4">Network usage</h2>
        <div class="space-y-6">
            <div>
                <div class="mt-4">
                    <div class="flex justify-between items-center mt-2 text-[#A6B0CF]">
                        <span>Layer 7</span>
                        <div class="w-20 bg-[#4458b8] h-2 rounded-full"></div>
                        <span class="bg-[#4458b8] text-xs px-2 py-1 text-[#ccd2e3] rounded-full">Layer 7</span>
                        <span class="text-green flex items-center">
                            <span class="w-2 h-2 bg-green rounded-full mr-2"></span>
                            Online
                        </span>
                    </div>
                </div>
            </div>
            <div>
                <div class="mt-4">
                    <div class="flex justify-between items-center mt-2 text-[#A6B0CF]">
                        <span>Layer 4</span>
                        <div class="w-20 bg-[#4458b8] h-2 rounded-full"></div>
                        <span class="bg-[#4458b8] text-xs px-2 py-1 text-[#ccd2e3] rounded-full">Layer 4</span>
                        <span class="text-green flex items-center">
                            <span class="w-2 h-2 bg-green rounded-full mr-2"></span>
                            Online
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<%- include('../partials/footer') %>
<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io(); 

    const userId = '<%= user._id %>';
    socket.emit('joinRoom', userId);

    socket.on('userConnected', (data) => {
        document.getElementById('usersOnline').textContent = data.count; 
    });

    socket.on('userDisconnected', (data) => {
        document.getElementById('usersOnline').textContent = data.count; 
    });

    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');
    const content = document.getElementById('content');

    menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        mobileMenu.classList.toggle('slide-in-active');
        content.classList.toggle('blurred');
        document.body.classList.toggle('no-scroll');
    });

    function animateValue(id, start, end, duration) {
        const obj = document.getElementById(id);
        const range = end - start;
        const minTimer = 50;
        let stepTime = Math.abs(Math.floor(duration / range));
        stepTime = Math.max(stepTime, minTimer);
        let startTime = new Date().getTime();
        let endTime = startTime + duration;
        let timer;

        function run() {
            let now = new Date().getTime();
            let remaining = Math.max((endTime - now) / duration, 0);
            let value = Math.round(end - (remaining * range));
            obj.innerHTML = value.toLocaleString();
            if (value === end) {
                clearInterval(timer);
            }
        }

        timer = setInterval(run, stepTime);
        run();
    }

    const initialData = {
        totalUsers: 0,
        totalAttacks: 0,
        runningBoots: 0,
        usersOnline: 0
    };

    const updateHubData = () => {
        fetch('/api/hub-data')
            .then(response => response.json())
            .then(data => {
                if (initialData.totalUsers === 0) {
                    animateValue("totalUsers", initialData.totalUsers, data.totalUsers, 2000);
                    animateValue("totalAttacks", initialData.totalAttacks, data.totalAttacks, 2000);
                    animateValue("runningBoots", initialData.runningBoots, data.runningBoots, 2000);
                    animateValue("usersOnline", initialData.usersOnline, data.usersOnline, 2000);
                } else {
                    document.getElementById('totalUsers').textContent = data.totalUsers;
                    document.getElementById('totalAttacks').textContent = data.totalAttacks;
                    document.getElementById('runningBoots').textContent = data.runningBoots;
                    document.getElementById('usersOnline').textContent = data.usersOnline;
                }

                initialData.totalUsers = data.totalUsers;
                initialData.totalAttacks = data.totalAttacks;
                initialData.runningBoots = data.runningBoots;
                initialData.usersOnline = data.usersOnline;

                document.getElementById('usersOnline').textContent = data.usersOnline;
            })
            .catch(error => console.error('Erro ao atualizar dados do hub:', error));
    };

    setInterval(updateHubData, 5000); 
    
    updateHubData();
</script>
</body>
</html>